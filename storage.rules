
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Rules for all files within the 'tickets' folder, organized by user ID.
    match /tickets/{userId}/{allPaths=**} {

      /**
       * Helper function to check if the user is an admin.
       * This should be kept in sync with firestore.rules.
       */
      function isAdmin() {
        return request.auth.token.email == 'mustansir133@gmail.com';
      }

      /**
       * Allow reads if the user is authenticated and is the owner of the files
       * or an administrator. This allows both ticket owners and support staff
       * to view attachments and voice notes.
       */
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());

      /**
       * Allow writes if the user is authenticated and is the owner of the directory
       * or an administrator. This allows users to upload files to their own tickets
       * and allows admins to upload files to any ticket's chat.
       */
      allow write: if request.auth != null && (request.auth.uid == userId || isAdmin());
    }
  }
}
    